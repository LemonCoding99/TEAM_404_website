<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>방명록</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/neodgm/neodgm-pro-webfont@1.020/neodgm_pro/style.css" />
    <link rel="stylesheet" href="./css/guestbook.css" />
    <!--.css파일이랑 연동-->
</head>

<body>
    <div class="container mt-4">
        <!-- 방명록 버튼 -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="pageName">방명록</span>
            <button type="button" class="btn btn-outline-light" id="mainBtn">메인 페이지</button>
            <!-- id 부여, 김동욱_0930_17:05 -->
        </div>

        <!-- 입력폼 카드 -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="mb-3">
                    <label for="nameInput" class="form-label">이름 입력</label>
                    <input type="text" class="form-control" id="nameInput" />
                </div>
                <div class="mb-3">
                    <label for="contentInput" class="form-label">내용 입력</label>
                    <textarea class="form-control contentArea" id="contentInput" rows="3"></textarea>
                </div>
                <button type="button" class="btn btn-outline-light" id="posting_btn">등록하기</button>
                <!-- 20251001_김동욱 id부여 -->
            </div>
        </div>

        <!-- 방문자 리스트 -->
        <div class="card">
            <div class="card-header">방문 리스트</div>
            <ul id="list" class="list-group list-group-flush"> <!-- 20251001_김동욱 id부여 -->
            </ul>
            <!-- 20251001_김동욱 리스트 폼 샘플 삭제 -->
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>

    <!-- 아래는 20251001_김동욱 추가 -->
    <!-- jQuery CDN 추가, 이 위치가 매우 중요 ( js모듈 호출보다 빨라야됨 ) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Firebase + 메인 스크립트 -->
    <script type="module">
        // Firebase SDK 라이브러리 가져오기 (CDN 방식)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs }
            from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAYLi5TwSKphv13Zzf6DkfXBUVeaDsAFjg",
            authDomain: "team404db.firebaseapp.com",
            projectId: "team404db",
            storageBucket: "team404db.firebasestorage.app",
            messagingSenderId: "605306413125",
            appId: "1:605306413125:web:ceb050305e235625ba032c",
            measurementId: "G-4RFR9742JX"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 등록 버튼 클릭 시 Firebase에 add
        $("#posting_btn").click(async function () {
            let name = $('#nameInput').val();
            let content = $('#contentInput').val();

            if (!name || !content) {
                alert("이름과 내용을 입력하세요!");
                return;
            }

            let doc = { 'name': name, 'content': content };
            await addDoc(collection(db, "comments"), doc);

            // 기존 : window.location.reload(); → 불필요하게 전체 새로고침
            // 개선 : 새 글만 리스트에 추가
            let temp_html = `
        <li class="list-group-item d-flex justify-content-between">
          <span>${name}</span>
          <span>${content}</span>
        </li>`;
            $('#list').append(temp_html);

            // 입력값 초기화
            $('#nameInput').val('');
            $('#contentInput').val('');

            alert('저장 완료!');
        });

        // Firestore에서 데이터 불러오기
        async function loadComments() {
            let docs = await getDocs(collection(db, "comments"));
            docs.forEach((doc) => {
                let row = doc.data();
                let name = row['name'];
                let content = row['content'];

                let temp_html = `
          <li class="list-group-item d-flex justify-content-between">
            <span>${name}</span>
            <span>${content}</span>
          </li>`;
                $('#list').append(temp_html);
            });
        }

        // DOM 준비 후 실행
        $(document).ready(function () {
            // 메인 페이지 이동 버튼
            $("#mainBtn").click(function () {
                window.location.href = "index.html";
            });

            // 방명록 초기화
            loadComments();
        });
    </script>

    <!-- JS 연동 -->
    <!-- <script type="module" src="./guestbook.js"></script>  -->
    <!-- guestbook.js를 HTML에서 일반 <script>로 불러오면 import 구문을 인식하지 못해서 관련 함수가 회색/불투명하게 표시됨, 그래서 type=module을 먹임 -->
    <!-- 각종 오류로 인해 html-JS 분리 포기 2025.10.01 -->

</body>

</html>